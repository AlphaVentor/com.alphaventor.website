const octofanImages=[],structureImages=[];for(let i=0;i<180;i++)octofanImages.push(`Composition1_1${`00${i}`.slice(-3)}.webp`);for(let i=1;i<170;i++)structureImages.push(`_0${`00${i}`.slice(-3)}.webp`);const requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;class EventEmitter{listeners={};addListener(eventName,fn){return this.listeners[eventName]=this.listeners[eventName]||[],this.listeners[eventName].push(fn),this}on(eventName,fn){return this.addListener(eventName,fn)}once(eventName,fn){this.listeners[eventName]=this.listeners[eventName]||[];const onceWrapper=()=>{fn(),this.off(eventName,onceWrapper)};return this.listeners[eventName].push(onceWrapper),this}off(eventName,fn){return this.removeListener(eventName,fn)}removeListener(eventName,fn){let lis=this.listeners[eventName];if(!lis)return this;for(let i=lis.length;i>0;i--)if(lis[i]===fn){lis.splice(i,1);break}return this}emit(eventName,...args){let fns=this.listeners[eventName];return!!fns&&(fns.forEach(f=>{f(...args)}),!0)}listenerCount(eventName){let fns;return(this.listeners[eventName]||[]).length}rawListeners(eventName){return this.listeners[eventName]}}class Canvas{constructor(e){this.images=e.images,this.container=e.container,this.cover=e.cover,this.displayIndex=0}setup(){var bodyName;"home"==document.body.className&&(this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",()=>this.resize()),this.resize())}renderIndex(e){if(this.images[e])return this.drawImage(e);for(var t=Number.MAX_SAFE_INTEGER,r=e;r>=0;r--)if(this.images[r]){t=r;break}for(var n=Number.MAX_SAFE_INTEGER,i=e,o=this.images.length;i<o;i++)if(this.images[i]){n=i;break}this.images[t]?this.drawImage(t):this.images[n]&&this.drawImage(n)}drawImage(e){this.displayIndex=e,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const x=Math.floor((this.canvas.width-this.images[this.displayIndex].naturalWidth)/2),y=Math.floor((this.canvas.height-this.images[this.displayIndex].naturalHeight)/2);this.cover?this.drawImageCover(this.ctx,this.images[this.displayIndex]):this.ctx.drawImage(this.images[this.displayIndex],x,y)}resize(){const w=this.container.clientWidth,h=this.container.clientHeight;this.canvas.style.height=`${h}px`,this.canvas.style.width=`${w}px`,this.canvas.height=h,this.canvas.width=w,this.renderIndex(this.displayIndex)}drawImageCover(ctx,img,x,y,w,h,offsetX,offsetY){2===arguments.length&&(x=y=0,w=ctx.canvas.width,h=ctx.canvas.height),(offsetX="number"==typeof offsetX?offsetX:.5)<0&&(offsetX=0),(offsetY="number"==typeof offsetY?offsetY:.5)<0&&(offsetY=0),offsetX>1&&(offsetX=1),offsetY>1&&(offsetY=1);var iw=img.width,ih=img.height,r=Math.min(w/iw,h/ih),nw=iw*r,nh=ih*r,cx,cy,cw,ch,ar=1;nw<w&&(ar=w/nw),Math.abs(ar-1)<1e-14&&nh<h&&(ar=h/nh),(cx=(iw-(cw=iw/((nw*=ar)/w)))*offsetX)<0&&(cx=0),(cy=(ih-(ch=ih/((nh*=ar)/h)))*offsetY)<0&&(cy=0),cw>iw&&(cw=iw),ch>ih&&(ch=ih),ctx.drawImage(img,cx,cy,cw,ch,x,y,w,h)}}class ImgLoader extends EventEmitter{constructor(opts){super(),this.images=opts.imgsRef,this.imageNames=opts.images,this.imagesRoot=opts.imagesRoot,this.sequenceLength=opts.images.length,this.priorityFranes=opts.priorityFrames,this.complete=!1,this.loadIndex=0,this.priorityQueue=this.createPriorityQueue(),this.loadingQueue=this.createLoadingQueue(),this.loadNextImage()}loadImage(e){if(this.images[e])return this.loadNextImage();const onLoad=()=>{img.removeEventListener("load",onLoad),this.images[e]=img,0===e&&this.emit("FIRST_IMAGE_LOADED"),this.loadNextImage()},img=new Image;img.addEventListener("load",onLoad),img.src=(this.imagesRoot?this.imagesRoot:"")+this.imageNames[e]}loadNextImage(){this.priorityQueue.length?(this.loadImage(this.priorityQueue.shift()),this.priorityQueue.length||this.emit("PRIORITY_IMAGES_LOADED")):this.loadingQueue.length?this.loadImage(this.loadingQueue.shift()):(this.complete=!0,this.emit("IMAGES_LOADED"))}createPriorityQueue(){const p=this.priorityFrames||[];return p.length||(p.push(0),p.push(Math.round(this.sequenceLength/2)),p.push(this.sequenceLength-1)),p}createLoadingQueue(){return this.imageNames.map((s,i)=>i).sort((e,n)=>Math.abs(e-this.sequenceLength/2)-Math.abs(n-this.sequenceLength/2))}}class ScrollSequence{constructor(opts){var bodyName;this.opts={container:"body",starts:"out",ends:"out",imagesRoot:"",cover:!1,...opts},this.container="object"==typeof opts.container?opts.container:document.querySelector(opts.container),this.scrollWith=opts.scrollWith?"object"==typeof opts.scrollWith?opts.scrollWith:document.querySelector(opts.scrollWith):this.container,this.images=Array(opts.images.length),this.imagesToLoad=opts.images,this.priorityFrames=opts.priorityFrames,this.loader=new ImgLoader({imgsRef:this.images,images:this.imagesToLoad,imagesRoot:this.opts.imagesRoot,priorityFrames:this.priorityFrames}),"home"==document.body.className&&(this.canvas=new Canvas({container:this.container,images:this.images,cover:this.opts.cover}),this.init())}init(){this.canvas.setup(),this.loader.once("FIRST_IMAGE_LOADED",()=>{this.canvas.renderIndex(0)}),this.loader.once("PRIORITY_IMAGES_LOADED",()=>{window.addEventListener("scroll",()=>this.changeOnWindowScroll())})}changeOnWindowScroll(){const step=100/(this.images.length-1),mapToIndex=Math.floor(this.percentScrolled/step);requestAnimationFrame(()=>this.canvas.renderIndex(mapToIndex))}get percentScrolled(){const{starts:starts,ends:ends}=this.opts,el=this.scrollWith,doc=document.documentElement,clientOffsety=doc.scrollTop||window.pageYOffset,elementHeight=el.clientHeight||el.offsetHeight,clientHeight=doc.clientHeight;let target=el,offsetY=0;do{offsetY+=target.offsetTop,target=target.offsetParent}while(target&&target!==window);let u=clientOffsety-offsetY,d=elementHeight+clientHeight;"out"===starts&&(u+=clientHeight),"in"===ends&&(d-=clientHeight),"in"==starts&&(d-=clientHeight);const value=u/d*100;return value>100?100:value<0?0:value}}const StructureSequence=new ScrollSequence({container:".structure-sequence",scrollWith:".structure-container",images:structureImages,imagesRoot:"/image/structure/",priorityFrames:[0,20,40,60,90],cover:!0,playUntil:"scroll-out",starts:"in",ends:"in"});ScrollOut({targets:".speak",cssProps:{viewportY:!0,visibleY:!0}});